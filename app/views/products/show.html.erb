<main>
  <section class="container py-5">
    <div class="row">
      <div class="col-sm-6">
        <%= render partial: "products/image_gallery", locals: { product: @product } %>
      </div> <!-- col -->

      <div class="col-sm-6">
        <h1 class="pb-2"><%= @product.name %></h1>
        <p class="h4"><%= @product.description.html_safe %></p>

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-blue btn-small" data-bs-toggle="modal" data-bs-target="#purchaseModal">
          Add to Cart
        </button>
      </div> <!-- col -->
    </div> <!-- row -->
  </section>


  <section class="container">
  </section>

</main>


<%= specs_text = "" %>
<%= notes_text = "" %>


<!-- Modal -->
<div class="modal fade" id="purchaseModal" tabindex="-1" aria-labelledby="purchaseModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <%= simple_form_for(@new_order_item) do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="purchaseModalLabel">Select Your Product Options</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <section class="">
            <% @product.components.each do |component| %>
              <h3 class="mt-3"><%= component.name %></h3>
              <div class="row justify-content-left">
                <% component.variants.each do |variant| %>
                  <div class="col-3 text-center">
                    <div class="select-box select-box<% component.id %>" id="c<%= component.id %>v<%= variant.id %>">
                      <%= image_tag variant.photos.first %>
                      <div class="text">
                        <%= variant.name %>
                        <% if variant.price_adjustment && variant.price_adjustment != 0 %>
                          <p><%= number_to_currency(variant.price_adjustment) %></p>
                        <% end %>
                      </div> <!-- text -->
                    </div> <!-- select box -->
                  </div> <!-- col -->
                <% end %>
              </div> <!-- row -->
            <% end %>
          </section>


          <%= f.hidden_field :order_id, value: @current_order.id %>
          <%= f.hidden_field :product_id, value: @product.id %>
          <%= f.hidden_field :quantity, value: 1  %>
          <%= f.hidden_field :specs, value: specs_text %>
          <%= f.hidden_field :notes, value: notes_text %>
          <%= f.hidden_field :total_price, value: @product.price %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <%= f.submit "Add to Cart", class: "btn btn-blue" %>
        </div> <!-- modal footer -->
      <% end %>
    </div> <!-- modal content -->
  </div> <!-- modal dialog -->
</div> <!-- modal -->



<!-- 
  order_item_specs
  order_item_notes
  order_item_total_price
-->

 <script>
  $( document ).ready(function() {
    $('.text').matchHeight();
    var order_item_specs = [];

    <% @product.components.each do |component| %>
      var component_name = "<%= component.name %>: "
      <% variants_count = component.variants.count %>
      <% if variants_count == 1 %>
        $('#c<%= component.id %>v<%= component.variants.first.id %>').addClass("active");
      <% else %>

        <% component.variants.each do |variant| %>
          $('#c<%= component.id %>v<%= component.variants.first.id %>').click(function(){
            $console.log("IT WAS CLICKED");
            $(".select-box<% component.id %>").removeClass("active");
            $(this).addClass("active");
            var selected_variant = "<%= variant.name %>"
            var component<%= component.id %>selection = component_name.concat(selected_variant);
          });
        <% end %>

      <% end %>
    <% end %> 

    $
  });
</script>





